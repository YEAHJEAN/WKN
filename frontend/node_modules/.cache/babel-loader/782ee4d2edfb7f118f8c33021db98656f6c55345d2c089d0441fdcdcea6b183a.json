{"ast":null,"code":"import React,{useState,useEffect}from'react';import io from'socket.io-client';import{useParams}from'react-router-dom';import ChatroomList from'./ChatroomList';import'./Chat.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io('http://43.202.124.253:3001');function Chat(){const{chatroom,username}=useParams();const userId=123;// 예시로 userId를 정의\nconst[currentChat,setCurrentChat]=useState(chatroom||'general');const[message,setMessage]=useState('');const[messages,setMessages]=useState([]);const[userJoined,setUserJoined]=useState('');useEffect(()=>{console.log('URL params:',{chatroom,username});// 클라이언트가 채팅방에 입장합니다.\nif(chatroom&&username){console.log(\"User \".concat(username,\" has joined chatroom \").concat(chatroom));socket.emit('joinRoom',chatroom);}if(currentChat&&username){socket.emit('joinRoom',currentChat);socket.on('initialMessages',initialMessages=>{setMessages(initialMessages);});socket.on('Chat',msg=>{setMessages(prevMessages=>[...prevMessages,msg]);});socket.on('userJoined',username=>{setUserJoined(\"\".concat(username,\"\\uB2D8\\uC774 \\uCC44\\uD305\\uBC29\\uC5D0 \\uC785\\uC7A5\\uD588\\uC2B5\\uB2C8\\uB2E4.\"));});return()=>{socket.off('initialMessages');socket.off('Chat');socket.off('userJoined');};}},[chatroom,username,currentChat]);const sendMessage=()=>{if(message.trim()&&username){socket.emit('Chat',{username,message,chatroom:currentChat});setMessage('');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Chat\"}),/*#__PURE__*/_jsx(ChatroomList,{userId:userId}),\" \",/*#__PURE__*/_jsx(\"hr\",{}),\" \",userJoined&&/*#__PURE__*/_jsx(\"div\",{className:\"user-joined\",children:userJoined}),messages.map((msg,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(msg.username===username?'sent-message':'received-message'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-bubble\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"username\",children:[msg.username,\":\"]}),\" \",msg.message]}),/*#__PURE__*/_jsxs(\"span\",{className:\"timestamp\",children:[\"(\",new Date(msg.timestamp).getHours(),\":\",new Date(msg.timestamp).getMinutes(),\")\"]})]},index)),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-hr\"}),\" \",/*#__PURE__*/_jsxs(\"div\",{className:\"message-input-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"message-input\",value:message,onChange:e=>setMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,className:\"send-button\",children:\"Send\"})]})]});}export default Chat;","map":{"version":3,"names":["React","useState","useEffect","io","useParams","ChatroomList","jsx","_jsx","jsxs","_jsxs","socket","Chat","chatroom","username","userId","currentChat","setCurrentChat","message","setMessage","messages","setMessages","userJoined","setUserJoined","console","log","concat","emit","on","initialMessages","msg","prevMessages","off","sendMessage","trim","className","children","map","index","Date","timestamp","getHours","getMinutes","type","value","onChange","e","target","onClick"],"sources":["C:/Users/user/mk/frontend/src/Chat.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport io from 'socket.io-client';\r\nimport { useParams } from 'react-router-dom';\r\nimport ChatroomList from './ChatroomList';\r\nimport './Chat.css';\r\n\r\nconst socket = io('http://43.202.124.253:3001');\r\n\r\nfunction Chat() {\r\n  const { chatroom, username } = useParams();\r\n  const userId = 123; // 예시로 userId를 정의\r\n  const [currentChat, setCurrentChat] = useState(chatroom || 'general');\r\n  const [message, setMessage] = useState('');\r\n  const [messages, setMessages] = useState([]);\r\n  const [userJoined, setUserJoined] = useState('');\r\n\r\n  useEffect(() => {\r\n    console.log('URL params:', { chatroom, username });\r\n\r\n    // 클라이언트가 채팅방에 입장합니다.\r\n    if (chatroom && username) {\r\n      console.log(`User ${username} has joined chatroom ${chatroom}`);\r\n      socket.emit('joinRoom', chatroom);\r\n    }\r\n\r\n    if (currentChat && username) {\r\n      socket.emit('joinRoom', currentChat);\r\n\r\n      socket.on('initialMessages', (initialMessages) => {\r\n        setMessages(initialMessages);\r\n      });\r\n\r\n      socket.on('Chat', (msg) => {\r\n        setMessages((prevMessages) => [...prevMessages, msg]);\r\n      });\r\n\r\n      socket.on('userJoined', (username) => {\r\n        setUserJoined(`${username}님이 채팅방에 입장했습니다.`);\r\n      });\r\n\r\n      return () => {\r\n        socket.off('initialMessages');\r\n        socket.off('Chat');\r\n        socket.off('userJoined');\r\n      };\r\n    }\r\n  }, [chatroom, username, currentChat]);\r\n\r\n  const sendMessage = () => {\r\n    if (message.trim() && username) {\r\n      socket.emit('Chat', { username, message, chatroom: currentChat });\r\n      setMessage('');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-container\">\r\n      <h1>Chat</h1>\r\n      <ChatroomList userId={userId} /> {/* ChatroomList 컴포넌트 사용 */}\r\n      <hr /> {/* 가로 경계선 추가 */}\r\n      {userJoined && <div className=\"user-joined\">{userJoined}</div>}\r\n      {messages.map((msg, index) => (\r\n        <div className={`message ${msg.username === username ? 'sent-message' : 'received-message'}`} key={index}>\r\n          <div className=\"message-bubble\">\r\n            <span className=\"username\">{msg.username}:</span> {msg.message}\r\n          </div>\r\n          <span className=\"timestamp\">({new Date(msg.timestamp).getHours()}:{new Date(msg.timestamp).getMinutes()})</span>\r\n        </div>\r\n      ))}\r\n      <div className=\"bottom-hr\" /> {/* 밑에 고정된 가로 경계선 */}\r\n      <div className=\"message-input-container\">\r\n        <input type=\"text\" className=\"message-input\" value={message} onChange={(e) => setMessage(e.target.value)} />\r\n        <button onClick={sendMessage} className=\"send-button\">Send</button>\r\n      </div>\r\n    </div>\r\n  ); \r\n}\r\n\r\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}